# The container definition we want to use for developing our app

box: oraclelinux:7.4

build:
  steps:

   - script:
     name: Downloading & Installing "wget" package
     code: |
      sudo yum install wget -y

   - script:
      name: Create "/u01/installs" directory to store all third party dependencies
      code: |
       mkdir -p /u01/installs
       cd /u01/installs

   - script:
      name: Download & Install JAVA, JRE dependency to a "/u01/installs" directory
      code: |
       echo ""; echo "Current working directory is :" `pwd`; echo ""
       wget --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" \
           $(curl -s http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html | \
               awk "/downloads\['/ && ! /demos/ && /\['files'\]/ && /linux-x64/ && /\.tar\.gz/" | \
               grep -o 'http.*\.tar\.gz' | tail -n 1 \
           )
       wget --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" \
           $(curl -s http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html | \
               awk "/downloads\['/ && ! /demos/ && /\['files'\]/ && /linux-x64/ && /\.tar\.gz/" | \
               grep -o 'http.*\.tar\.gz' | tail -n 1 \
           )
       tar zxf `ls jdk*.tar.gz`; mv `tar tzf jdk*.tar.gz | head -1 | cut -f1 -d"/"` jdk; chmod 777 -R jdk
       tar zxf `ls jre*.tar.gz`; mv `tar tzf jre*.tar.gz | head -1 | cut -f1 -d"/"` jre; chmod 777 -R jre

   - script:
      name: Setting up JAVA Environment variables & testing with java -version
      code: |
       export JAVA_HOME=/u01/installs/jdk; echo ""; echo $JAVA_HOME
       export JRE_HOME=/u01/installs/jre; echo ""; echo $JRE_HOME
       export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin; echo ""; echo $PATH; echo ""
       java -version

   - script:
      name: Download & Install ANT dependency to a "/u01/installs" directory
      code: |
       echo ""; echo "Current working directory is :" `pwd`; echo ""
       wget http://archive.apache.org/dist/ant/binaries/apache-ant-1.10.1-bin.tar.gz
       tar zxf `ls apache*.tar.gz`; mv `tar tzf apache*.tar.gz | head -1 | cut -f1 -d"/"` ant; chmod 777 -R ant

   - script:
      name: Setting up ANT Environment variables & testing with ant -version
      code : |
       export ANT_HOME=/u01/installs/ant; echo ""; echo $ANT_HOME
       export PATH=$PATH:$ANT_HOME/bin; echo ""; echo $PATH; echo ""
       ant -version

#
#   - script:
#      name: build and stage the project
#      code: |
#       make docker-stage
#       ls -ltr
#       cp -r docker-stage/. $WERCKER_OUTPUT_DIR/
#       cp -r wercker/. $WERCKER_OUTPUT_DIR/
#
#
#push-release:
#  box: oraclelinux:7.3
#  steps:
#   - script:
#      name: copy distribution
#      code: |
#       mkdir -p /u01/oracle
#       cp -r $WERCKER_SOURCE_DIR/. /u01/oracle/
#
#   - internal/docker-push:
#      name: Push the third party dependency containing image to repository
#      username: $DOCKER_USERNAME
#      password: $DOCKER_PASSWORD
#      repository: docker.io/vpriyankaprabhu/thirdpartydependencystdimage
#      tag: $WERCKER_GIT_COMMIT
#      working-dir: /u01/installs/
#      registry: https://docker.io